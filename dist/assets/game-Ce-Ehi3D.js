class t{constructor(){this.canvas=document.getElementById("mario-game"),this.ctx=null,this.gameRunning=!1,this.score=0,this.frame=0,this.cameraX=0,this.player=null,this.blocks=[],this.enemies=[],this.items=[],this.particles=[],this.coins=[],this.fireballs=[],this.flagpole=null,this.currentLevel=1,this.totalLevels=5,this.lives=3,this.screenShake={x:0,y:0,intensity:0,decay:.9},this.backgroundLayers=[],this.decorations=[],this.keys={right:!1,left:!1,up:!1,down:!1,run:!1,shoot:!1},this.gameConstants={TILE_SIZE:32,GRAVITY:.4,FRICTION:.9,JUMP_FORCE:-14,ACCEL:.55,MAX_SPEED:5.5,MAX_RUN_SPEED:8.5,COYOTE_TIME:10,JUMP_BUFFER:10,BOUNCE_DAMPING:.6,ENEMY_KNOCKBACK:-6},this.audioCtx=null,this.initAudio(),this.particlePool=[],this.fireballPool=[],this.coinPool=[],this.enemyPool=[],this.itemPool=[],this.spatialGrid={},this.spatialGridSize=64,this.cachedSkyGradient=null,this.cachedCloudGradient=null,this.lastCanvasWidth=0,this.lastCanvasHeight=0,this.viewLeft=0,this.viewRight=0,this.isMobile="ontouchstart"in window||navigator.maxTouchPoints>0,this.supportsVibration="vibrate"in navigator,this.isMuted="true"===localStorage.getItem("gameMuted"),this.highScore=parseInt(localStorage.getItem("gameHighScore")||"0")}initAudio(){try{this.audioCtx=new(window.AudioContext||window.webkitAudioContext)}catch(t){console.warn("Audio not supported")}}init(){this.canvas&&(this.ctx=this.canvas.getContext("2d"),this.setupEventListeners(),this.updateMuteButton(),this.generateBackgroundLayers(),this.showMobileControls(),this.drawStartScreen())}vibrate(t=10){this.supportsVibration&&!this.isMuted&&navigator.vibrate(t)}triggerScreenShake(t=5){this.screenShake.intensity=t}updateScreenShake(){this.screenShake.intensity>.5?(this.screenShake.x=(Math.random()-.5)*this.screenShake.intensity,this.screenShake.y=(Math.random()-.5)*this.screenShake.intensity,this.screenShake.intensity*=this.screenShake.decay):(this.screenShake.x=0,this.screenShake.y=0,this.screenShake.intensity=0)}generateBackgroundLayers(){this.backgroundLayers={mountains:[],hills:[],clouds:[],bushes:[]};for(let t=0;t<10;t++)this.backgroundLayers.mountains.push({x:400*t+100*Math.random(),height:80+60*Math.random(),width:150+100*Math.random()});for(let t=0;t<15;t++)this.backgroundLayers.hills.push({x:250*t+50*Math.random(),height:40+30*Math.random(),width:100+50*Math.random()});for(let t=0;t<12;t++)this.backgroundLayers.clouds.push({x:200*t+100*Math.random(),y:30+80*Math.random(),scale:.6+.8*Math.random()});for(let t=0;t<20;t++)this.backgroundLayers.bushes.push({x:150*t+50*Math.random(),scale:.5+.5*Math.random()})}showMobileControls(){const t=document.getElementById("mobileControls");t&&this.isMobile&&(t.style.display="block")}setupEventListeners(){const t=document.getElementById("startGameBtn"),e=document.getElementById("restartBtn"),i=document.getElementById("muteBtn");t&&t.addEventListener("click",()=>this.startGame()),e&&e.addEventListener("click",()=>this.startGame()),i&&i.addEventListener("click",()=>this.toggleMute()),window.addEventListener("keydown",t=>{this.handleKeyDown(t),this.gameRunning&&this.shouldPreventDefault(t)&&t.preventDefault()}),window.addEventListener("keyup",t=>this.handleKeyUp(t)),this.setupTouchControls()}toggleMute(){this.isMuted=!this.isMuted,localStorage.setItem("gameMuted",this.isMuted),this.updateMuteButton()}updateMuteButton(){const t=document.getElementById("muteBtn");t&&(this.isMuted?t.innerHTML='\n        <svg class="icon-svg-inline" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n          <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n          <line x1="23" y1="9" x2="17" y2="15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n          <line x1="17" y1="9" x2="23" y2="15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n        </svg>\n      ':t.innerHTML='\n        <svg class="icon-svg-inline" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n          <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n          <path d="M19.07 4.93C20.98 6.84 21.96 9.42 21.96 12C21.96 14.58 20.98 17.16 19.07 19.07M15.54 8.46C16.47 9.39 17 10.7 17 12C17 13.3 16.47 14.61 15.54 15.54" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n        </svg>\n      ')}updateScore(t){this.score+=t,this.score>this.highScore&&(this.highScore=this.score,localStorage.setItem("gameHighScore",this.highScore));const e=document.getElementById("scoreDisplay");e&&(e.textContent=this.score.toString().padStart(6,"0"),e.style.transform="scale(1.2)",e.style.color="#FFD700",setTimeout(()=>{e.style.transform="scale(1)",e.style.color="#fff"},150));const i=document.getElementById("mobileScore");i&&(i.textContent=this.score)}updateLivesDisplay(){const t=document.getElementById("livesDisplay");t&&(t.textContent=this.lives,t.style.transform="scale(1.3)",t.style.color="#ef4444",setTimeout(()=>{t.style.transform="scale(1)",t.style.color="#fff"},200))}updatePowerDisplay(t){const e=document.getElementById("powerDisplay");e&&(e.textContent=t,e.style.transform="scale(1.2)",setTimeout(()=>{e.style.transform="scale(1)"},150))}drawStartScreen(){const t=this.ctx,e=this.canvas.width,i=this.canvas.height,s=t.createLinearGradient(0,0,0,i);s.addColorStop(0,"#5c94fc"),s.addColorStop(1,"#87ceeb"),t.fillStyle=s,t.fillRect(0,0,e,i),t.fillStyle="#8b4513",t.fillRect(0,i-64,e,64),t.fillStyle="#228b22",t.fillRect(0,i-64,e,16),this.drawCloud(t,100,80,1),this.drawCloud(t,350,50,.8),this.drawCloud(t,600,100,1.2),t.fillStyle="#fff",t.strokeStyle="#000",t.lineWidth=4,t.font="bold 36px 'Press Start 2P', monospace",t.textAlign="center",t.strokeText("SUPER APPUZLOTA",e/2,i/2-40),t.fillText("SUPER APPUZLOTA",e/2,i/2-40),t.font="16px monospace",t.fillStyle="#333",t.fillText("Press START to play",e/2,i/2+20),this.drawPreviewMario(t,e/2-16,i-100)}drawCloud(t,e,i,s=1){t.save(),t.translate(e,i),t.scale(s,s);const l=t.createRadialGradient(30,15,0,30,20,50);l.addColorStop(0,"rgba(255, 255, 255, 0.95)"),l.addColorStop(.4,"rgba(255, 255, 255, 0.8)"),l.addColorStop(.7,"rgba(240, 248, 255, 0.6)"),l.addColorStop(1,"rgba(230, 240, 250, 0.3)"),t.fillStyle=l,t.beginPath(),t.ellipse(30,18,38,20,0,0,2*Math.PI),t.fill(),t.fillStyle="rgba(255, 255, 255, 0.85)",t.beginPath(),t.arc(8,18,18,0,2*Math.PI),t.fill(),t.beginPath(),t.arc(52,18,20,0,2*Math.PI),t.fill(),t.beginPath(),t.arc(30,8,15,0,2*Math.PI),t.fill(),t.fillStyle="rgba(255, 255, 255, 0.5)",t.beginPath(),t.ellipse(25,10,12,6,-.3,0,2*Math.PI),t.fill(),t.restore()}drawPreviewMario(t,e,i){t.fillStyle="#e52521",t.fillRect(e+4,i,24,8),t.fillRect(e,i+8,32,4),t.fillStyle="#ffc0a0",t.fillRect(e+4,i+12,24,10),t.fillStyle="#000",t.fillRect(e+8,i+14,4,4),t.fillRect(e+20,i+14,4,4),t.fillStyle="#e52521",t.fillRect(e+4,i+22,24,10),t.fillStyle="#0066cc",t.fillRect(e+4,i+32,24,12),t.fillStyle="#8b4513",t.fillRect(e+2,i+44,10,6),t.fillRect(e+20,i+44,10,6)}setupEventListeners(){const t=document.getElementById("startGameBtn"),e=document.getElementById("restartBtn");t&&t.addEventListener("click",()=>this.startGame()),e&&e.addEventListener("click",()=>this.startGame()),window.addEventListener("keydown",t=>{this.handleKeyDown(t),this.gameRunning&&this.shouldPreventDefault(t)&&t.preventDefault()}),window.addEventListener("keyup",t=>this.handleKeyUp(t)),this.setupTouchControls()}setupTouchControls(){const t=document.getElementById("touchLeft"),e=document.getElementById("touchRight"),i=document.getElementById("touchUp"),s=document.getElementById("touchDown"),l=document.getElementById("touchRun"),a=document.getElementById("touchShoot"),h=(t,e,i,s=10)=>{t&&(t.addEventListener("touchstart",i=>{i.cancelable&&i.preventDefault(),this.vibrate(s),e(),t.classList.add("active")},{passive:!1}),t.addEventListener("touchend",e=>{e.cancelable&&e.preventDefault(),i(),t.classList.remove("active")},{passive:!1}),t.addEventListener("touchcancel",e=>{e.cancelable&&e.preventDefault(),i(),t.classList.remove("active")},{passive:!1}))};h(t,()=>{this.keys.left=!0},()=>{this.keys.left=!1}),h(e,()=>{this.keys.right=!0},()=>{this.keys.right=!1}),h(i,()=>{this.gameRunning&&this.player&&this.player.tryJump(this),this.keys.up=!0},()=>{this.keys.up=!1},[10,5,10]),h(s,()=>{this.keys.down=!0},()=>{this.keys.down=!1}),h(l,()=>{this.keys.run=!0},()=>{this.keys.run=!1}),h(a,()=>{this.gameRunning&&this.player&&this.player.shoot(this)},()=>{},[15,10,15])}getParticle(t,i,s){if(this.particlePool.length>0){const e=this.particlePool.pop();return e.x=t,e.y=i,e.color=s,e.vx=8*(Math.random()-.5),e.vy=6*-Math.random()-2,e.size=6*Math.random()+4,e.life=30,e.dead=!1,e.rotation=Math.random()*Math.PI*2,e.rotationSpeed=.3*(Math.random()-.5),e}return new e(t,i,s)}returnParticle(t){this.particlePool.length<100&&this.particlePool.push(t)}getFireball(t,e,i){if(this.fireballPool.length>0){const s=this.fireballPool.pop();return s.reset(t,e,i),s}return new a(t,e,i)}returnFireball(t){this.fireballPool.length<50&&this.fireballPool.push(t)}getCoin(t,e){if(this.coinPool.length>0){const i=this.coinPool.pop();return i.reset(t,e),i}return new i(t,e)}returnCoin(t){this.coinPool.length<100&&this.coinPool.push(t)}getSpatialKey(t,e){return`${Math.floor(t/this.spatialGridSize)},${Math.floor(e/this.spatialGridSize)}`}updateSpatialGrid(){this.spatialGrid={};for(let t=0;t<this.blocks.length;t++){const e=this.blocks[t];if(e.broken)continue;const i=Math.floor(e.x/this.spatialGridSize),s=Math.floor((e.x+e.w)/this.spatialGridSize),l=Math.floor(e.y/this.spatialGridSize),a=Math.floor((e.y+e.h)/this.spatialGridSize);for(let h=i;h<=s;h++)for(let e=l;e<=a;e++){const i=`${h},${e}`;this.spatialGrid[i]||(this.spatialGrid[i]=[]),this.spatialGrid[i].push({type:"block",index:t})}}}getNearbyBlocks(t){const e=[],i=Math.floor(t.x/this.spatialGridSize),s=Math.floor((t.x+t.w)/this.spatialGridSize),l=Math.floor(t.y/this.spatialGridSize),a=Math.floor((t.y+t.h)/this.spatialGridSize);for(let o=i-1;o<=s+1;o++)for(let t=l-1;t<=a+1;t++){const i=`${o},${t}`;this.spatialGrid[i]&&e.push(...this.spatialGrid[i])}const h=[],n=new Set;for(const o of e)n.has(o.index)||(n.add(o.index),h.push(this.blocks[o.index]));return h}updateViewBounds(){this.viewLeft=this.cameraX-100,this.viewRight=this.cameraX+this.canvas.width+100}isInView(t,e,i,s){return t+i>this.viewLeft&&t<this.viewRight&&e+s>-50&&e<this.canvas.height+50}getSkyGradient(){const t=this.canvas.width,e=this.canvas.height;return this.cachedSkyGradient&&this.lastCanvasWidth===t&&this.lastCanvasHeight===e||(this.cachedSkyGradient=this.ctx.createLinearGradient(0,0,0,e),this.cachedSkyGradient.addColorStop(0,"#5c94fc"),this.cachedSkyGradient.addColorStop(1,"#87ceeb"),this.lastCanvasWidth=t,this.lastCanvasHeight=e),this.cachedSkyGradient}shouldPreventDefault(t){return["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Space"].includes(t.code)}handleKeyDown(t){switch(t.code){case"ArrowRight":case"KeyD":this.keys.right=!0;break;case"ArrowLeft":case"KeyA":this.keys.left=!0;break;case"ArrowUp":case"KeyW":case"Space":!this.keys.up&&this.gameRunning&&this.player&&this.player.tryJump(this),this.keys.up=!0;break;case"ShiftLeft":case"ShiftRight":this.keys.run=!0;break;case"KeyX":case"KeyZ":this.keys.shoot=!0,this.player&&this.player.canShoot&&this.player.shoot(this)}}handleKeyUp(t){switch(t.code){case"ArrowRight":case"KeyD":this.keys.right=!1;break;case"ArrowLeft":case"KeyA":this.keys.left=!1;break;case"ArrowUp":case"KeyW":case"Space":this.keys.up=!1;break;case"ShiftLeft":case"ShiftRight":this.keys.run=!1;break;case"KeyX":case"KeyZ":this.keys.shoot=!1}}startGame(){this.score=0,this.cameraX=0,this.frame=0;const t=document.getElementById("scoreDisplay"),e=document.getElementById("startGameBtn"),i=document.getElementById("gameOverScreen");t&&(t.innerText="000000"),e&&(e.style.display="none"),i&&i.classList.remove("active"),this.blocks=[],this.enemies=[],this.items=[],this.particles=[],this.coins=[],this.flagpole=null,this.loadLevel(),this.spawnPlayer(),this.gameRunning=!0,this.canvas.focus(),this.gameLoop()}loadLevel(){this.blocks=[],this.enemies=[],this.items=[],this.particles=[],this.coins=[],this.fireballs=[],this.flagpole=null;const t=this.getLevelMaps(),e=t[(this.currentLevel-1)%t.length].map,s={1:{spawnX:80,enemySpeed:-1.5,name:"WORLD 1-1",gravity:.45},2:{spawnX:60,enemySpeed:-2,name:"WORLD 1-2",gravity:.5},3:{spawnX:60,enemySpeed:-2.5,name:"WORLD 1-3",gravity:.55},4:{spawnX:40,enemySpeed:-3,name:"WORLD 1-4",gravity:.6}},l=s[this.currentLevel]||s[1];this.currentLevelConfig=l,this.updateLevelUI(),e.forEach((t,s)=>{[...t].forEach((t,a)=>{const o=a*this.gameConstants.TILE_SIZE,r=s*this.gameConstants.TILE_SIZE+(this.canvas.height-e.length*this.gameConstants.TILE_SIZE);switch(t){case"#":this.blocks.push({x:o,y:r,w:this.gameConstants.TILE_SIZE,h:this.gameConstants.TILE_SIZE,type:"ground"});break;case"B":this.blocks.push({x:o,y:r,w:this.gameConstants.TILE_SIZE,h:this.gameConstants.TILE_SIZE,type:"brick",broken:!1});break;case"?":this.blocks.push({x:o,y:r,w:this.gameConstants.TILE_SIZE,h:this.gameConstants.TILE_SIZE,type:"question",content:Math.random()>.5?"mushroom":"coin",active:!0,bounceOffset:0});break;case"!":this.blocks.push({x:o,y:r,w:this.gameConstants.TILE_SIZE,h:this.gameConstants.TILE_SIZE,type:"brick",broken:!1,unbreakable:!0});break;case"P":this.blocks.push({x:o,y:r,w:this.gameConstants.TILE_SIZE,h:this.gameConstants.TILE_SIZE,type:"pipe"});break;case"T":this.blocks.push({x:o,y:r,w:this.gameConstants.TILE_SIZE,h:2*this.gameConstants.TILE_SIZE,type:"pipe"});break;case"C":this.coins.push(new i(o+8,r+8));break;case"G":this.enemies.push(new h(o,r,l.enemySpeed));break;case"K":this.enemies.push(new n(o,r,l.enemySpeed));break;case"F":this.flagpole={x:o,y:this.canvas.height-13*this.gameConstants.TILE_SIZE,h:12*this.gameConstants.TILE_SIZE}}})})}getLevelMaps(){return[{map:["................................................................","................................................................","................................................................","...............................C.C.C.............................",".............?B?B?...............................................","................................................................",".............................PPPP................................","...............C.C...........P..P......?..?.?.....................","................C............P..P................................","..........PPP...............P..P.....G.......G......PPP..........",".........P...P..........G...P..P.............G.....P...P.........","..C.C....P...P..............P..P...................P...P.........","...C..C..P...P..C.C.C.......P..P...C.C.C............P...P......F.","########################################################.#######","########################################################.#######"],coins:8,enemies:3},{map:["................................................................","................................................................","............................C.C........................C.C............",".......................?B?B...................................?B?B.......","................................................................","...................PPP...PPP...PPP...PPP...PPP...PPP............",".............C.C.C...P..P......?..?.?...P..P......C.C.C.........","............P..P................P..P................G........G......",".......PPP......P..P.....G.......G...........PPP...P..P....K.K....",".........P...P.......G...P..P..........G.....P...P.......P...P......",".C.C....P...P...........P..P...................P...P.......?B?B?....F.","..C..C...P...P..C.C.C.......P..P...C.C.C..........P..P...C.C.C........","#######################################.#######.##########################","#######################################.#######.##########################"],coins:12,enemies:5},{map:["................................................................","................................................................","................C.C.C...................C.C.C................C.C.C","............!B!B!B!B!........?B?B?......................!B!B!B!B!B!","................................................................","..........PPP...PPP.......P..P...PPP.......P..P...T...T.........","......C.C.C................P..P..............?B?B?...P..P..P..K.K","..............P..P...................P..P.....................G...G......",".....PPP......P..P.....G.......G.......T...T.....PPP.....K.K..G..G...","........P...P.......G...P..P.............P...P.......!B!B!B!B!B!......F.","C.C...P...P..............P..P...................P...P..C.C.C........","#######################################################.#######","#######################################################.#######"],coins:15,enemies:7},{map:["................................................................","................................................................","..................C.C.C..C.C.C..C.C.C....................C.C.C....","...........!B!B!B!B!B!..?B?B?...!B!B!B!B!B!..?B?B?......!B!B!B!B!B!","................................................................",".......T..T...T..T.....P..P...T..T...T..T....T..T..............",".......C.C.C......P..P..P..P..........?B?B?..........P..P..K.K..K.K","..........P..P......G..G..G...G..G................G..G..G............",".....T..T......P..P..G..G..G...T..T.....T..T.....K.K..G..G..G..G...","........P...P.......G...P..P.......!B!B!B!B!B!..!B!B!B!B!B!......!B!B!F.","C.C...P...P..............P..P...................P...P..C.C.C.......K.K....","########################################################","########################################################"],coins:20,enemies:10},{map:["..................................................................................","........................................C.C.C......................................",".......................................!B!B!B!.....................................","..........................C.C.......................C.C............................",".........................?B?B?.....................!B!B!...........................","...................................................................................",".................T...........................................T.....................",".................P..P.....................................P..P.....................",".................P..P.......PPP.........PPP.........PPP...P..P.........F...........",".......PPP.......P..P......P...P.......P...P.......P...P..P..P.....................","......P...P......P..P......P...P...G...P...P...K...P...P..P..P...G.................","......P...P......P..P......P...P.......P...P.......P...P..P..P.....................","..C...P...P..C...P..P..C...P...P.......P...P.......P...P..P..P.....................","####################################################################################","####################################################################################"],coins:25,enemies:15}]}updateLevelUI(){const t=document.getElementById("levelDisplay");if(t){const e=this.currentLevelConfig;t.textContent=`${e.name}`}}spawnPlayer(){const t=this.currentLevelConfig,e=this.canvas.height-2*this.gameConstants.TILE_SIZE-48;this.player=new l(t.spawnX,e),t.gravity&&(this.gameConstants.GRAVITY=t.gravity)}startGame(){this.score=0,this.cameraX=0,this.frame=0,this.lives=3;const t=document.getElementById("scoreDisplay"),e=document.getElementById("startOverlay"),i=document.getElementById("gameOverScreen"),s=document.getElementById("levelDisplay"),l=document.getElementById("livesDisplay"),a=document.getElementById("powerDisplay");t&&(t.innerText="000000"),e&&e.classList.add("hidden"),i&&i.classList.remove("active"),s&&(s.innerText=`${this.currentLevel}-1`),l&&(l.innerText=this.lives),a&&(a.innerText="SMALL"),this.loadLevel(),this.spawnPlayer(),this.gameRunning=!0,this.canvas.focus(),this.gameLoop()}nextLevel(){this.currentLevel<this.totalLevels?(this.currentLevel++,this.score+=5e3,this.startGame()):this.gameOver(!0)}restartLevel(){this.score=0,this.cameraX=0,this.loadLevel(),this.spawnPlayer(),this.gameRunning=!0,this.canvas.focus(),this.gameLoop()}playSound(t){if(this.isMuted||!this.audioCtx)return;"suspended"===this.audioCtx.state&&this.audioCtx.resume();const e=this.audioCtx.createOscillator(),i=this.audioCtx.createGain();e.connect(i),i.connect(this.audioCtx.destination);const s=this.audioCtx.currentTime;switch(t){case"jump":e.type="square",e.frequency.setValueAtTime(150,s),e.frequency.exponentialRampToValueAtTime(400,s+.12),i.gain.setValueAtTime(.08,s),i.gain.linearRampToValueAtTime(.01,s+.12),e.start(s),e.stop(s+.12);break;case"coin":e.type="sine",e.frequency.setValueAtTime(988,s),e.frequency.setValueAtTime(1319,s+.08),i.gain.setValueAtTime(.08,s),i.gain.linearRampToValueAtTime(.01,s+.18),e.start(s),e.stop(s+.18);break;case"stomp":e.type="triangle",e.frequency.setValueAtTime(400,s),e.frequency.exponentialRampToValueAtTime(100,s+.1),i.gain.setValueAtTime(.12,s),i.gain.linearRampToValueAtTime(.01,s+.1),e.start(s),e.stop(s+.1);break;case"die":e.type="triangle",e.frequency.setValueAtTime(400,s),e.frequency.linearRampToValueAtTime(100,s+.5),i.gain.setValueAtTime(.2,s),i.gain.linearRampToValueAtTime(0,s+.5),e.start(s),e.stop(s+.5);break;case"powerup":e.type="sine",e.frequency.setValueAtTime(523,s),e.frequency.setValueAtTime(659,s+.1),e.frequency.setValueAtTime(784,s+.2),e.frequency.setValueAtTime(1047,s+.3),i.gain.setValueAtTime(.08,s),i.gain.linearRampToValueAtTime(.01,s+.4),e.start(s),e.stop(s+.4);break;case"fireball":e.type="sawtooth",e.frequency.setValueAtTime(800,s),e.frequency.exponentialRampToValueAtTime(200,s+.1),i.gain.setValueAtTime(.06,s),i.gain.linearRampToValueAtTime(.01,s+.1),e.start(s),e.stop(s+.1);break;case"bump":e.type="square",e.frequency.setValueAtTime(100,s),e.frequency.setValueAtTime(80,s+.05),i.gain.setValueAtTime(.1,s),i.gain.linearRampToValueAtTime(0,s+.08),e.start(s),e.stop(s+.08);break;case"break":e.type="sawtooth",e.frequency.setValueAtTime(200,s),e.frequency.exponentialRampToValueAtTime(50,s+.15),i.gain.setValueAtTime(.15,s),i.gain.linearRampToValueAtTime(0,s+.15),e.start(s),e.stop(s+.15);break;case"kick":e.type="square",e.frequency.setValueAtTime(250,s),e.frequency.exponentialRampToValueAtTime(100,s+.08),i.gain.setValueAtTime(.12,s),i.gain.linearRampToValueAtTime(0,s+.08),e.start(s),e.stop(s+.08)}}spawnParticles(t,e,i,s=4,l={}){const{velocityMultiplier:a=1,sizeMultiplier:h=1,gravity:n=!0,glow:o=!1}=l;for(let r=0;r<s;r++){const s=this.getParticle(t,e,i);s.vx*=a,s.vy*=a,s.size*=h,s.hasGravity=n,s.glow=o,this.particles.push(s)}}spawnBurstParticles(t,e,i,s=12){for(let l=0;l<s;l++){const a=l/s*Math.PI*2,h=3+4*Math.random(),n=i[Math.floor(Math.random()*i.length)],o=this.getParticle(t,e,n);o.vx=Math.cos(a)*h,o.vy=Math.sin(a)*h,o.size=4+4*Math.random(),o.life=40,o.glow=!0,this.particles.push(o)}}spawnStarParticles(t,e,i=6){const s=["#FFD700","#FFA500","#FFFF00","#FFE4B5"];for(let l=0;l<i;l++){const a=l/i*Math.PI*2,h=2+3*Math.random(),n=s[Math.floor(Math.random()*s.length)],o=this.getParticle(t,e,n);o.vx=Math.cos(a)*h,o.vy=Math.sin(a)*h-2,o.size=3+3*Math.random(),o.life=35,o.glow=!0,o.isStar=!0,this.particles.push(o)}}gameLoop(){this.gameRunning&&(this.update(),this.render(),this.frame++,requestAnimationFrame(()=>this.gameLoop()))}update(){this.updateViewBounds(),this.updateSpatialGrid();const t=this.player.x-.35*this.canvas.width;t>this.cameraX&&(this.cameraX+=.08*(t-this.cameraX)),this.cameraX<0&&(this.cameraX=0);const e=this.getNearbyBlocks(this.player);this.player.update(this.keys,e,this);for(let i=this.enemies.length-1;i>=0;i--){const t=this.enemies[i];if(this.isInView(t.x,t.y,t.w,t.h)){const e=this.getNearbyBlocks(t);t.update(e,this.player,this)}t.dead&&this.enemies.splice(i,1)}for(let i=this.items.length-1;i>=0;i--){const t=this.items[i],e=this.getNearbyBlocks(t);t.update(e,this.player,this),t.dead&&this.items.splice(i,1)}for(let i=this.coins.length-1;i>=0;i--){const t=this.coins[i];t.update(this.player,this),t.collected&&(this.returnCoin(t),this.coins.splice(i,1))}for(let i=this.particles.length-1;i>=0;i--){const t=this.particles[i];t.update(),t.dead&&(this.returnParticle(t),this.particles.splice(i,1))}if(this.player.fireballs)for(let i=this.player.fireballs.length-1;i>=0;i--){const t=this.player.fireballs[i];t.update(this.blocks,this.enemies,this),t.dead&&(this.returnFireball(t),this.player.fireballs.splice(i,1))}this.player.dead&&this.gameOver(!1),this.flagpole&&this.player.x>this.flagpole.x&&(this.spawnFlagpoleCelebration(),this.gameOver(!0))}spawnFlagpoleCelebration(){const t=["#FFD700","#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEAA7","#DDA0DD"];for(let e=0;e<30;e++){const e=Math.random()*Math.PI*2,i=3+6*Math.random(),s=t[Math.floor(Math.random()*t.length)],l=this.getParticle(this.flagpole.x+17,this.flagpole.y+20+40*Math.random(),s);l.vx=Math.cos(e)*i,l.vy=Math.sin(e)*i-3,l.size=4+6*Math.random(),l.life=50+30*Math.random(),l.maxLife=l.life,l.glow=!0,l.isStar=Math.random()>.5,this.particles.push(l)}this.triggerScreenShake(8),this.vibrate([50,30,50,30,100])}render(){const t=this.ctx,e=this.canvas.width,i=this.canvas.height;this.updateScreenShake(),t.save(),t.translate(this.screenShake.x,this.screenShake.y),t.fillStyle=this.getSkyGradient(),t.fillRect(0,0,e,i),this.drawParallaxBackground(t,e,i),t.save(),t.translate(-this.cameraX,0),this.drawBlocks(),this.drawFlagpole(),this.drawCoins(),this.drawItems(),this.drawEnemies(),this.drawPlayer(),this.drawParticles(),this.drawFireballs(),t.restore(),t.restore()}drawParallaxBackground(t,e,i){const s=.1*this.cameraX;t.fillStyle="rgba(100, 130, 180, 0.4)",this.backgroundLayers.mountains.forEach(l=>{const a=l.x-s%4e3;a>-l.width&&a<e+l.width&&(t.beginPath(),t.moveTo(a,i-64),t.lineTo(a+l.width/2,i-64-l.height),t.lineTo(a+l.width,i-64),t.closePath(),t.fill())});const l=.2*this.cameraX;t.fillStyle="rgba(50, 120, 80, 0.5)",this.backgroundLayers.hills.forEach(s=>{const a=s.x-l%3750;a>-s.width&&a<e+s.width&&(t.beginPath(),t.ellipse(a+s.width/2,i-64,s.width/2,s.height,0,Math.PI,0),t.fill())});const a=.3*this.cameraX;this.backgroundLayers.clouds.forEach((i,s)=>{const l=i.x-a%2400+5*Math.sin(.01*this.frame+s);l>-100&&l<e+100&&this.drawCloud(t,l,i.y,i.scale)});const h=.5*this.cameraX;t.fillStyle="#228B22",this.backgroundLayers.bushes.forEach(s=>{const l=s.x-h%3e3;if(l>-50&&l<e+50){const e=i-64,a=20*s.scale;t.beginPath(),t.arc(l,e,a,Math.PI,0),t.arc(l+.8*a,e,.8*a,Math.PI,0),t.arc(l-.8*a,e,.7*a,Math.PI,0),t.fill()}})}drawBlocks(){const t=this.ctx;this.blocks.forEach(e=>{if(e.broken)return;if(!(e.x+e.w>this.cameraX&&e.x<this.cameraX+this.canvas.width))return;const i=e.bounceOffset||0,s=e.y+i;switch(e.type){case"ground":const i=t.createLinearGradient(e.x,s,e.x,s+8);i.addColorStop(0,"#32CD32"),i.addColorStop(.3,"#228B22"),i.addColorStop(1,"#1B5E20"),t.fillStyle=i,t.fillRect(e.x,s,e.w,8),t.fillStyle="#228B22";for(let n=0;n<e.w;n+=8)t.fillRect(e.x+n,s,4,3);const l=t.createLinearGradient(e.x,s+8,e.x,s+e.h);l.addColorStop(0,"#8B4513"),l.addColorStop(.5,"#A0522D"),l.addColorStop(1,"#654321"),t.fillStyle=l,t.fillRect(e.x,s+8,e.w,e.h-8),t.fillStyle="rgba(0, 0, 0, 0.1)";for(let n=0;n<e.w*(e.h-8)/64;n++){const i=e.x+17*n%e.w,l=s+12+23*n%(e.h-20);t.fillRect(i,l,2,2)}break;case"brick":const a=t.createLinearGradient(e.x,s,e.x+e.w,s);a.addColorStop(0,"#CD853F"),a.addColorStop(.2,"#D2691E"),a.addColorStop(.8,"#D2691E"),a.addColorStop(1,"#8B4513"),t.fillStyle=a,t.fillRect(e.x,s,e.w,e.h),t.strokeStyle="rgba(0, 0, 0, 0.3)",t.lineWidth=1,t.beginPath(),t.moveTo(e.x,s+e.h/2),t.lineTo(e.x+e.w,s+e.h/2),t.stroke(),t.fillStyle="rgba(255, 255, 255, 0.2)",t.fillRect(e.x,s,e.w,2),t.fillRect(e.x,s,2,e.h),t.fillStyle="rgba(0, 0, 0, 0.2)",t.fillRect(e.x+e.w-2,s,2,e.h),t.fillRect(e.x,s+e.h-2,e.w,2);break;case"question":e.active,t.fillStyle=e.active?"#ffd700":"#c7a008",t.fillRect(e.x,s,e.w,e.h),t.fillStyle=e.active?"#ffeb3b":"#8b6914",t.fillRect(e.x+3,s+3,e.w-6,e.h-6),e.active&&(t.fillStyle="#fff",t.font="bold 18px sans-serif",t.textAlign="center",t.textBaseline="middle",t.fillText("?",e.x+e.w/2,s+e.h/2+1)),t.shadowColor=e.active?"#ffd700":"transparent",t.shadowBlur=e.active?15:0,t.shadowOffsetX=0,t.shadowOffsetY=0;break;case"pipe":const h=t.createLinearGradient(e.x,s,e.x+e.w,s);h.addColorStop(0,"#00a800"),h.addColorStop(.3,"#00c800"),h.addColorStop(1,"#006400"),t.fillStyle=h,t.fillRect(e.x,s,e.w,e.h),t.fillStyle="#50d050",t.fillRect(e.x+4,s+4,e.w-8,e.h-8),t.fillStyle="#228b22",t.fillRect(e.x+2,s-4,e.w-4,8);break;case"!":t.fillStyle="#7f8c8d",t.fillRect(e.x,s,e.w,e.h),t.fillStyle="#575344",t.fillRect(e.x,s,e.w,2),t.fillRect(e.x,s,e.w,2),t.fillRect(e.x,s,e.w-2,e.h,2),t.fillRect(e.x,s+e.h-2,e.w,2),t.fillStyle="#999",t.fillRect(e.x+6,s+6,e.w-12,2)}e.bounceOffset&&(e.bounceOffset+=.6,e.bounceOffset>0&&(e.bounceOffset=0))})}drawFlagpole(){if(!this.flagpole)return;const t=this.ctx,e=t.createLinearGradient(this.flagpole.x+14,this.flagpole.y,this.flagpole.x+20,this.flagpole.y);e.addColorStop(0,"#228B22"),e.addColorStop(.3,"#32CD32"),e.addColorStop(.6,"#228B22"),e.addColorStop(1,"#006400"),t.fillStyle=e,t.fillRect(this.flagpole.x+14,this.flagpole.y,6,this.flagpole.h),t.fillStyle="rgba(255, 255, 255, 0.3)",t.fillRect(this.flagpole.x+14,this.flagpole.y,2,this.flagpole.h);const i=t.createRadialGradient(this.flagpole.x+17,this.flagpole.y,0,this.flagpole.x+17,this.flagpole.y,8);i.addColorStop(0,"#FFFF00"),i.addColorStop(.5,"#FFD700"),i.addColorStop(1,"#DAA520"),t.fillStyle=i,t.beginPath(),t.arc(this.flagpole.x+17,this.flagpole.y,8,0,2*Math.PI,!1),t.fill(),t.fillStyle="rgba(255, 255, 255, 0.5)",t.beginPath(),t.arc(this.flagpole.x+14,this.flagpole.y-3,3,0,2*Math.PI,!1),t.fill(),t.fillStyle="#00a800",t.beginPath(),t.moveTo(this.flagpole.x+20,this.flagpole.y+10),t.lineTo(this.flagpole.x+55,this.flagpole.y+25),t.lineTo(this.flagpole.x+20,this.flagpole.y+40),t.closePath(),t.fill(),t.fillStyle="#fff",t.beginPath(),t.arc(this.flagpole.x+35,this.flagpole.y+25,5,0,2*Math.PI,!1),t.fill()}drawCoins(){this.coins.forEach(t=>{!t.collected&&this.isInView(t.x,t.y,t.w,t.h)&&t.draw(this.ctx,this.frame)})}drawItems(){this.items.forEach(t=>{this.isInView(t.x,t.y,t.w,t.h)&&t.draw(this.ctx,this.frame)})}drawEnemies(){this.enemies.forEach(t=>{this.isInView(t.x,t.y,t.w,t.h)&&t.draw(this.ctx,this.frame)})}drawPlayer(){this.player.draw(this.ctx,this)}drawParticles(){this.particles.forEach(t=>{this.isInView(t.x-10,t.y-10,20,20)&&t.draw(this.ctx)})}drawFireballs(){this.player.fireballs&&this.player.fireballs.forEach(t=>{this.isInView(t.x,t.y,t.w,t.h)&&t.draw(this.ctx)})}gameOver(t){this.gameRunning=!1,t?this.vibrate([50,30,50,30,100]):this.vibrate([100,50,200]);const e=document.getElementById("gameOverScreen"),i=document.getElementById("gameOverTitle"),s=document.getElementById("finalScore"),l=document.querySelector(".overlay-icon");if(e&&e.classList.remove("win","lose"),i&&(t?(e&&e.classList.add("win"),this.currentLevel<this.totalLevels?(i.innerText="LEVEL CLEAR!",l&&(l.innerHTML='\n            <svg class="icon-svg-inline" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n              <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>\n              <path d="M9 12L11 14L15 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n            </svg>')):(i.innerText="YOU WIN!",l&&(l.innerHTML='\n            <svg class="icon-svg-inline" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n              <path d="M12 2L15 8L22 9L17 14L18 21L12 18L6 21L7 14L2 9L9 8L12 2Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>\n            </svg>'))):(e&&e.classList.add("lose"),i.innerText="GAME OVER",l&&(l.innerHTML='\n          <svg class="icon-svg-inline" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>\n            <path d="M15 9L9 15M9 9L15 15" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>\n          </svg>'))),s){let t=0;const e=this.score,i=Math.ceil(e/30),l=()=>{t=Math.min(t+i,e),s.innerText=t.toLocaleString(),t<e&&requestAnimationFrame(l)};l()}if(e){e.classList.add("active");const i=document.getElementById("restartBtn");i&&(t&&this.currentLevel<this.totalLevels?(i.innerHTML='\n            <svg class="icon-svg-inline" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n              <path d="M5 12H19M19 12L12 5M19 12L12 19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n            </svg>\n            NEXT LEVEL',i.onclick=()=>this.nextLevel()):(i.innerHTML='\n            <svg class="icon-svg-inline" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n              <path d="M3 12C3 7.5 6.5 4 11 4C14 4 16.5 5.5 18 8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>\n              <path d="M21 12C21 16.5 17.5 20 13 20C10 20 7.5 18.5 6 16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>\n              <path d="M3 8L6 5L9 8M21 16L18 19L15 16" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n            </svg>\n            PLAY AGAIN',i.onclick=()=>{this.currentLevel=1,this.startGame()}))}}updateScore(t){this.score+=t;const e=document.getElementById("scoreDisplay"),i=document.getElementById("mobileScore");if(e){let t=this.score.toString();for(;t.length<6;)t="0"+t;e.innerText=t}i&&(i.innerText=this.score)}hitBlock(t){"question"===t.type&&t.active?(t.active=!1,t.bounceOffset=-12,this.triggerScreenShake(3),this.vibrate(15),"mushroom"===t.content?(this.items.push(new o(t.x,t.y-32)),this.playSound("powerup"),this.spawnBurstParticles(t.x+16,t.y,["#FFD700","#FFA500","#FF6347"],8)):(this.updateScore(200),this.spawnStarParticles(t.x+16,t.y-16),this.playSound("coin"))):"brick"===t.type&&(t.unbreakable?(t.bounceOffset=-6,this.playSound("bump"),this.vibrate(10)):this.player.isBig?(t.broken=!0,this.triggerScreenShake(5),this.vibrate([10,5,15]),this.spawnBurstParticles(t.x+16,t.y+16,["#c84c0c","#8B4513","#A0522D","#D2691E"],12),this.playSound("break"),this.updateScore(50)):(t.bounceOffset=-8,this.playSound("bump"),this.vibrate(8)))}}class e{constructor(t,e,i){this.x=t,this.y=e,this.color=i,this.vx=8*(Math.random()-.5),this.vy=6*-Math.random()-2,this.size=6*Math.random()+4,this.life=30,this.maxLife=30,this.dead=!1,this.rotation=Math.random()*Math.PI*2,this.rotationSpeed=.3*(Math.random()-.5),this.hasGravity=!0,this.glow=!1,this.isStar=!1,this.isSpeedLine=!1}update(){this.x+=this.vx,this.y+=this.vy,this.hasGravity&&(this.vy+=.4),this.rotation+=this.rotationSpeed,this.vx*=.98,this.life--,this.life<=0&&(this.dead=!0)}draw(t){t.save(),t.translate(this.x,this.y),t.rotate(this.rotation);const e=this.life/this.maxLife,i=.5+this.life/this.maxLife*.5;if(this.glow&&(t.shadowColor=this.color,t.shadowBlur=10),t.globalAlpha=e,t.fillStyle=this.color,this.isStar)this.drawStar(t,0,0,5,this.size*i,this.size*i*.5);else if(this.isSpeedLine){const i=8+12*(1-e);t.fillRect(-i/2,-1,i,2)}else{const e=this.size*i;t.fillRect(-e/2,-e/2,e,e)}t.globalAlpha=1,t.shadowBlur=0,t.restore()}drawStar(t,e,i,s,l,a){let h=Math.PI/2*3,n=e,o=i;const r=Math.PI/s;t.beginPath(),t.moveTo(e,i-l);for(let c=0;c<s;c++)n=e+Math.cos(h)*l,o=i+Math.sin(h)*l,t.lineTo(n,o),h+=r,n=e+Math.cos(h)*a,o=i+Math.sin(h)*a,t.lineTo(n,o),h+=r;t.lineTo(e,i-l),t.closePath(),t.fill()}}class i{constructor(t,e){this.x=t,this.y=e,this.w=16,this.h=16,this.collected=!1,this.collectAnimation=0,this.floatOffset=Math.random()*Math.PI*2}reset(t,e){this.x=t,this.y=e,this.collected=!1,this.collectAnimation=0}update(t,e){this.collected||t.x<this.x+this.w&&t.x+t.w>this.x&&t.y<this.y+this.h&&t.y+t.h>this.y&&(this.collected=!0,e.updateScore(100),e.playSound("coin"),e.vibrate(8),e.spawnStarParticles(this.x+8,this.y+8))}draw(t,e){const i=12*Math.abs(Math.sin(.1*e))+4,s=3*Math.sin(.08*e+this.floatOffset);t.fillStyle="rgba(0, 0, 0, 0.2)",t.beginPath(),t.ellipse(this.x+8,this.y+18,i/2+1,3,0,0,2*Math.PI),t.fill(),t.shadowColor="#FFD700",t.shadowBlur=8;const l=t.createRadialGradient(this.x+6,this.y+4+s,0,this.x+8,this.y+8+s,12);l.addColorStop(0,"#FFFF8A"),l.addColorStop(.3,"#FFD700"),l.addColorStop(.7,"#DAA520"),l.addColorStop(1,"#B8860B"),t.fillStyle=l,t.beginPath(),t.ellipse(this.x+8,this.y+8+s,i/2+2,10,0,0,2*Math.PI),t.fill(),t.shadowBlur=0,t.strokeStyle="#B8860B",t.lineWidth=1,t.beginPath(),t.ellipse(this.x+8,this.y+8+s,i/2+2,10,0,0,2*Math.PI),t.stroke();const a=t.createRadialGradient(this.x+7,this.y+5+s,0,this.x+7,this.y+6+s,6);a.addColorStop(0,"#FFFFE0"),a.addColorStop(1,"#FFFACD"),t.fillStyle=a,t.beginPath(),t.ellipse(this.x+7,this.y+7+s,i/3-1,4,0,0,2*Math.PI),t.fill(),t.fillStyle="rgba(255, 255, 255, 0.9)",t.beginPath(),t.ellipse(this.x+5,this.y+4+s,2,3,-.5,0,2*Math.PI),t.fill(),t.fillStyle="#B8860B",t.font="bold 8px sans-serif",t.textAlign="center",t.textBaseline="middle",t.fillText("$",this.x+8,this.y+8+s)}}class s{constructor(t,e,i,s,l){this.x=t,this.y=e,this.w=i,this.h=s,this.vx=0,this.vy=0,this.color=l,this.dead=!1}collide(t){return this.x<t.x+t.w&&this.x+this.w>t.x&&this.y<t.y+t.h&&this.y+this.h>t.y}}class l extends s{constructor(t,e){super(t,e,24,32,"red"),this.isBig=!1,this.hasFire=!1,this.invincible=!1,this.invincibleTimer=0,this.facingRight=!0,this.grounded=!1,this.coyoteTimer=0,this.jumpBufferTimer=0,this.walkFrame=0,this.fireballs=[],this.canShoot=!0,this.shootCooldown=0,this.wasInAir=!1,this.landingDustTimer=0,this.speedLineTimer=0}update(t,e,i){const s=i.gameConstants;t.right&&(this.vx+=s.ACCEL,this.facingRight=!0),t.left&&(this.vx-=s.ACCEL,this.facingRight=!1),t.left||t.right||(this.vx*=s.FRICTION);const l=t.run?s.MAX_RUN_SPEED:s.MAX_SPEED;this.vx=Math.max(-l,Math.min(l,this.vx)),Math.abs(this.vx)<.1&&(this.vx=0),this.x+=this.vx,this.checkCollision(e,!0,i),this.x<0&&(this.x=0),this.vy+=s.GRAVITY,!t.up&&this.vy<-4&&(this.vy+=.5),this.vy>12&&(this.vy=12),this.y+=this.vy;const a=this.grounded;this.grounded=!1,this.checkCollision(e,!1,i),this.grounded?(this.coyoteTimer=s.COYOTE_TIME,this.wasInAir&&this.vy>=0&&(this.spawnLandingDust(i),this.landingDustTimer=10,i.vibrate(5)),this.wasInAir=!1):a&&this.vy>0&&this.coyoteTimer--,!this.grounded&&Math.abs(this.vy)>2&&(this.wasInAir=!0),this.landingDustTimer>0&&this.landingDustTimer--,Math.abs(this.vx)>s.MAX_SPEED&&this.grounded?(this.speedLineTimer++,this.speedLineTimer%3==0&&this.spawnSpeedLine(i)):this.speedLineTimer=0,t.up&&!this.jumpBufferTimer&&(this.jumpBufferTimer=s.JUMP_BUFFER),this.jumpBufferTimer>0&&this.jumpBufferTimer--,this.jumpBufferTimer>0&&(this.grounded||this.coyoteTimer>0)&&(this.executeJump(i),this.jumpBufferTimer=0),this.y>i.canvas.height+50&&this.die(i),this.invincible&&(this.invincibleTimer--,this.invincibleTimer<=0&&(this.invincible=!1)),Math.abs(this.vx)>.5&&(this.walkFrame+=.15*Math.abs(this.vx)),this.shootCooldown>0?this.shootCooldown--:this.canShoot=!0}tryJump(t){this.grounded||this.coyoteTimer>0?this.executeJump(t):this.jumpBufferTimer=t.gameConstants.JUMP_BUFFER}executeJump(t){this.vy=t.gameConstants.JUMP_FORCE,this.grounded=!1,this.coyoteTimer=0,t.playSound("jump"),this.spawnJumpDust(t)}spawnJumpDust(t){const e=["#E8DCC8","#D4C4A8","#C0B090"];for(let i=0;i<4;i++){const i=Math.PI+(Math.random()-.5)*Math.PI*.6,s=2+1.5*Math.random(),l=e[Math.floor(Math.random()*e.length)],a=t.getParticle(this.x+this.w/2+12*(Math.random()-.5),this.y+this.h,l);a.vx=Math.cos(i)*s,a.vy=Math.sin(i)*s*.5,a.size=2+3*Math.random(),a.life=12+6*Math.random(),a.maxLife=a.life,a.hasGravity=!0,a.glow=!1,t.particles.push(a)}}spawnLandingDust(t){const e=["#E8DCC8","#D4C4A8","#C0B090","#A89070"];for(let i=0;i<6;i++){const i=(Math.random()-.5)*Math.PI,s=1.5+2*Math.random(),l=e[Math.floor(Math.random()*e.length)],a=t.getParticle(this.x+this.w/2+16*(Math.random()-.5),this.y+this.h-4,l);a.vx=Math.cos(i)*s*(this.facingRight?1:-1),a.vy=1.5*-Math.random()-.5,a.size=3+4*Math.random(),a.life=15+10*Math.random(),a.maxLife=a.life,a.hasGravity=!1,a.glow=!1,t.particles.push(a)}}spawnSpeedLine(t){const e=["rgba(255, 255, 255, 0.6)","rgba(200, 220, 255, 0.5)","rgba(180, 200, 255, 0.4)"],i=e[Math.floor(Math.random()*e.length)],s=t.getParticle(this.x+(this.facingRight?-8:this.w+8),this.y+this.h/2+(Math.random()-.5)*this.h*.8,i);s.vx=this.facingRight?-4:4,s.vy=0,s.size=2,s.life=8,s.maxLife=8,s.hasGravity=!1,s.isSpeedLine=!0,t.particles.push(s)}shoot(t){if(!this.hasFire||!this.canShoot||this.fireballs.length>=2)return;const e=this.facingRight?1:-1;this.fireballs.push(t.getFireball(this.x+(this.facingRight?this.w:-8),this.y+this.h/2,e)),this.canShoot=!1,this.shootCooldown=15,t.playSound("fireball")}grow(t){const e=document.getElementById("powerDisplay");this.isBig?this.hasFire||(this.hasFire=!0,e&&(e.innerText="FIRE")):(this.isBig=!0,this.y-=16,this.h=48,e&&(e.innerText="BIG")),t.playSound("powerup"),t.updateScore(1e3)}takeDamage(t){if(this.invincible)return;const e=document.getElementById("powerDisplay");this.hasFire?(this.hasFire=!1,this.invincible=!0,this.invincibleTimer=90,e&&(e.innerText="BIG"),t.playSound("die")):this.isBig?(this.isBig=!1,this.h=32,this.y+=16,this.invincible=!0,this.invincibleTimer=90,e&&(e.innerText="SMALL"),t.playSound("die")):this.die(t)}die(t){this.dead=!0,t.playSound("die")}checkCollision(t,e,i){t.forEach(t=>{t.broken||this.collide(t)&&(e?(this.vx>0?this.x=t.x-this.w:this.vx<0&&(this.x=t.x+t.w),this.vx=0):this.vy>0?(this.y=t.y-this.h,this.vy=0,this.grounded=!0):this.vy<0&&(this.y=t.y+t.h,this.vy=1,i.hitBlock(t)))})}draw(t,e){if(this.invincible&&Math.floor(e.frame/4)%2==0)return;t.save();const i=this.facingRight?1:-1,s=this.facingRight?this.x:this.x+this.w;t.translate(s,this.y),t.scale(i,1);const l=this.w,a=this.h,h=Math.abs(this.vx)>.5;Math.floor(this.walkFrame);const n=!this.grounded,o=this.hasFire?"#fff":"#e52521",r=(this.hasFire,"#e52521"),c=this.hasFire?"#e52521":"#0066cc",d="#ffc0a0",f="#8b4513";if(this.isBig){t.fillStyle="rgba(0, 0, 0, 0.2)",t.beginPath(),t.ellipse(this.x+l/2,this.y+a,14,4,0,0,2*Math.PI,!1),t.fill(),t.fillStyle=this.hasFire?"#ccc":"#c41e3a",t.fillRect(4,1,l-8,6),t.fillRect(0,9,l,4),t.fillStyle=o,t.fillRect(4,0,l-8,8),t.fillRect(0,8,l,6),t.fillStyle="rgba(255, 255, 255, 0.2)",t.fillRect(5,1,l-10,3),t.fillStyle="#8b4513",t.beginPath(),t.arc(l-3,11,4,0,2*Math.PI,!1),t.fill(),t.fillStyle="rgba(255, 194, 144, 0.8)",t.fillRect(4,14,l-8,12),t.fillStyle=d,t.fillRect(4,14,l-8,12),t.fillStyle=d,t.beginPath(),t.arc(l-2,18,3,0,2*Math.PI,!1),t.fill(),t.fillStyle="#fff",t.fillRect(9,19,2,2),t.fillRect(8,18,1,1),t.fillStyle="#000",t.fillRect(8,18,4,4),t.fillStyle="rgba(255, 182, 193, 0.4)",t.fillRect(3,22,3,2),t.fillStyle="#e5a88a",t.fillRect(10,22,4,3),t.fillStyle="#5D3A1A",t.fillRect(4,26,l-8,1),t.fillStyle="#8b4513",t.fillRect(4,22,l-8,4),t.fillStyle="#654321",t.fillRect(4,25,l-8,1),t.fillStyle="#8B4513",t.fillRect(8,24,6,2),t.fillStyle="rgba(229, 37, 33, 0.8)",t.fillRect(2,26,l-4,10),t.fillStyle=r,t.fillRect(2,26,l-4,10),t.fillStyle="rgba(255, 255, 255, 0.1)",t.fillRect(3,27,l-6,3),t.fillStyle=c,t.fillRect(3,28,5,4),t.fillRect(l-8,28,5,4),t.fillStyle=c,t.fillRect(0,32,l,10),t.fillRect(4,28,6,8),t.fillRect(l-10,28,6,8),t.fillStyle="rgba(0, 0, 100, 0.1)",t.fillRect(2,34,l-4,7),t.fillStyle="#ccac00",t.fillRect(7,35,3,3),t.fillRect(l-9,35,3,3),t.fillStyle="#ffd700",t.fillRect(6,34,4,4),t.fillRect(l-10,34,4,4),t.fillStyle="rgba(255, 255, 255, 0.4)",t.fillRect(7,35,2,2),t.fillRect(l-9,35,2,2);const e=n?4:h?3*Math.sin(.8*this.walkFrame):0;t.fillStyle=c,t.fillRect(2,42,8,6+e),t.fillRect(l-10,42,8,6-e),t.fillStyle="rgba(255, 255, 255, 0.1)",t.fillRect(3,42,3,4),t.fillRect(l-9,42,3,4),t.fillStyle="#5D3A1A",t.fillRect(0,a-4,10,2),t.fillRect(l-10,a-4,10,2),t.fillStyle=f,t.fillRect(0,a-6,10,6),t.fillRect(l-10,a-6,10,6),t.fillStyle="#654321",t.fillRect(1,a-4,4,2),t.fillRect(l-5,a-4,4,2),t.fillStyle="rgba(255, 255, 255, 0.2)",t.fillRect(1,a-5,3,1),t.fillRect(l-9,a-5,3,1)}else{t.fillStyle=o,t.fillRect(4,0,l-8,6),t.fillRect(0,6,l,4),t.fillStyle=d,t.fillRect(4,10,l-8,8),t.fillStyle="#000",t.fillRect(8,12,3,3),t.fillStyle="#8b4513",t.fillRect(4,16,l-8,2),t.fillStyle=r,t.fillRect(2,18,l-4,6),t.fillStyle=c,t.fillRect(2,22,l-4,6);const e=n?2:h?2*Math.sin(.8*this.walkFrame):0;t.fillRect(2,28,8,4+e),t.fillRect(l-10,28,8,4-e),t.fillStyle=f,t.fillRect(0,a-4,10,4),t.fillRect(l-10,a-4,10,4)}t.restore()}}class a extends s{constructor(t,e,i){super(t,e,12,12,"#ff6600"),this.vx=8*i,this.vy=0,this.bounces=0}reset(t,e,i){this.x=t,this.y=e,this.vx=8*i,this.vy=0,this.bounces=0,this.dead=!1}update(t,e,i){this.vy+=.4,this.x+=this.vx,this.y+=this.vy,t.forEach(t=>{t.broken||this.collide(t)&&(this.vy>0?(this.y=t.y-this.h,this.vy=-6,this.bounces++):this.dead=!0)}),e.forEach(t=>{t.dead||t.squished||!this.collide(t)||(t.dead=!0,this.dead=!0,i.updateScore(100),i.spawnParticles(t.x+8,t.y+8,"#ff6600",6),i.playSound("stomp"))}),(this.y>i.canvas.height||this.bounces>3)&&(this.dead=!0)}draw(t){const e=t.createRadialGradient(this.x+6,this.y+6,0,this.x+6,this.y+6,10);e.addColorStop(0,"rgba(255, 200, 0, 0.8)"),e.addColorStop(.5,"rgba(255, 100, 0, 0.4)"),e.addColorStop(1,"rgba(255, 50, 0, 0)"),t.fillStyle=e,t.beginPath(),t.arc(this.x+6,this.y+6,10,0,2*Math.PI,!1),t.fill();const i=t.createRadialGradient(this.x+4,this.y+4,0,this.x+6,this.y+6,6);i.addColorStop(0,"#FFFF00"),i.addColorStop(.5,"#FF8C00"),i.addColorStop(1,"#FF4500"),t.fillStyle=i,t.beginPath(),t.arc(this.x+6,this.y+6,6,0,2*Math.PI,!1),t.fill(),t.fillStyle="#FFFFE0",t.beginPath(),t.arc(this.x+5,this.y+5,3,0,2*Math.PI,!1),t.fill(),t.fillStyle="rgba(255, 255, 255, 0.8)",t.beginPath(),t.arc(this.x+4,this.y+4,2,0,2*Math.PI,!1),t.fill();for(let s=0;s<3;s++){const e=this.x+6-(this.vx>0?3*-s:3*s),i=this.y+6+2*Math.sin(Date.now()/50+s),l=4-s,a=.6-.2*s;t.fillStyle=`rgba(255, ${150-30*s}, 0, ${a})`,t.beginPath(),t.arc(e,i,l,0,2*Math.PI,!1),t.fill()}}}class h extends s{constructor(t,e){super(t,e,28,28,"#ac7c00"),this.vx=-1.5,this.deadTimer=0,this.squished=!1,this.walkFrame=0}update(t,e,i){if(this.dead)return;if(this.squished)return this.deadTimer--,void(this.deadTimer<=0&&(this.dead=!0));this.walkFrame+=.15,this.x+=this.vx;let s=!1;t.forEach(t=>{t.broken||this.collide(t)&&(this.y+this.h-5<=t.y?(this.y=t.y-this.h,s=!0):(this.vx*=-1,this.x+=2*this.vx))}),s||(this.y+=4),e.collide(this)&&!e.dead&&(e.vy>0&&e.y+e.h-e.vy<=this.y+8?(this.squished=!0,this.deadTimer=25,e.vy=-9,i.updateScore(100),i.playSound("stomp")):e.invincible||e.takeDamage(i))}draw(t,e){if(!this.dead)if(this.squished)t.fillStyle="#8B4513",t.beginPath(),t.ellipse(this.x+14,this.y+24,16,6,0,0,2*Math.PI,!1),t.fill(),t.fillStyle="#654321",t.beginPath(),t.ellipse(this.x+10,this.y+24,6,3,.3,0,2*Math.PI,!1),t.fill(),t.beginPath(),t.ellipse(this.x+18,this.y+24,5,2,-.3,0,2*Math.PI,!1),t.fill(),t.fillStyle="#fff",t.beginPath(),t.ellipse(this.x+8,this.y+24,4,3,0,0,2*Math.PI,!1),t.ellipse(this.x+20,this.y+24,4,3,0,0,2*Math.PI,!1),t.fill(),t.fillStyle="#000",t.fillRect(this.x+6,this.y+23,2,2),t.fillRect(this.x+22,this.y+23,2,2),t.strokeStyle="#000",t.lineWidth=1,t.beginPath(),t.moveTo(this.x+4,this.y+22),t.lineTo(this.x+8,this.y+26),t.moveTo(this.x+8,this.y+22),t.lineTo(this.x+4,this.y+26),t.stroke();else{const e=2*Math.sin(this.walkFrame);t.fillStyle="rgba(0, 0, 0, 0.2)",t.beginPath(),t.ellipse(this.x+14,this.y+28,12,4,0,0,2*Math.PI,!1),t.fill();const i=t.createRadialGradient(this.x+14,this.y+10,0,this.x+14,this.y+10,14);i.addColorStop(0,"#D2691E"),i.addColorStop(.7,"#A0522D"),i.addColorStop(1,"#8B4513"),t.fillStyle=i,t.beginPath(),t.ellipse(this.x+14,this.y+10,14,12,0,0,2*Math.PI,!1),t.fill(),t.fillStyle="rgba(139, 69, 19, 0.5)";for(let s=0;s<5;s++){const e=this.x+6+s%3*8,i=this.y+8+8*Math.floor(s/3);t.beginPath(),t.arc(e,i,1.5,0,2*Math.PI,!1),t.fill()}t.fillStyle="#DEB887",t.beginPath(),t.ellipse(this.x+14,this.y+14,8,6,0,0,2*Math.PI,!1),t.fill(),t.fillStyle="rgba(255, 255, 255, 0.3)",t.beginPath(),t.ellipse(this.x+12,this.y+12,3,2,-.5,0,2*Math.PI,!1),t.fill(),t.fillStyle="#fff",t.beginPath(),t.arc(this.x+8,this.y+10,5,0,2*Math.PI,!1),t.arc(this.x+20,this.y+10,5,0,2*Math.PI,!1),t.fill(),t.fillStyle="#fff",t.fillRect(this.x+6,this.y+8,2,2),t.fillRect(this.x+19,this.y+8,2,2),t.fillStyle="#000",t.fillRect(this.x+6,this.y+10,3,4),t.fillRect(this.x+19,this.y+10,3,4),t.fillStyle="#4a0080",t.beginPath(),t.moveTo(this.x+3,this.y+5),t.lineTo(this.x+11,this.y+7),t.lineTo(this.x+11,this.y+5),t.lineTo(this.x+3,this.y+5),t.fill(),t.beginPath(),t.moveTo(this.x+21,this.y+5),t.lineTo(this.x+25,this.y+7),t.lineTo(this.x+25,this.y+5),t.lineTo(this.x+21,this.y+5),t.fill(),t.fillStyle="#D2691E",t.beginPath(),t.arc(this.x+14,this.y+17,3,0,2*Math.PI,!1),t.fill(),t.fillStyle="#8B4513",t.fillRect(this.x+12,this.y+16,4,2),t.fillStyle="#4a0080",t.beginPath(),t.arc(this.x+14,this.y+21,4,.2,Math.PI-.2,!1),t.stroke(),t.fillStyle="#2F1810",t.fillRect(this.x+2-e,this.y+20,10,6),t.fillRect(this.x+16+e,this.y+20,10,6),t.fillStyle="#8B4513",t.fillRect(this.x+2-e,this.y+20,10,2),t.fillRect(this.x+16+e,this.y+20,10,2),t.fillStyle="#5D3A1A",t.fillRect(this.x+2-e,this.y+24,3,2),t.fillRect(this.x+8-e,this.y+24,3,2),t.fillRect(this.x+16+e,this.y+24,3,2),t.fillRect(this.x+22+e,this.y+24,3,2)}}}class n extends s{constructor(t,e,i=-2){super(t,e,32,44,"#00a800"),this.vx=i,this.deadTimer=0,this.squished=!1,this.shellSpeed=0,this.isShell=!1,this.inShell=!1,this.walkFrame=0}update(t,e,i){if(this.dead)return;if(this.squished)return this.deadTimer--,void(this.deadTimer<=0&&(this.dead=!0));this.walkFrame+=.12,this.x+=this.vx;let s=!1;t.forEach(t=>{t.broken||this.collide(t)&&(this.y+this.h-5<=t.y?(this.y=t.y-this.h,s=!0):(this.vx*=-1,this.x+=2*this.vx))}),s||(this.y+=5),e.collide(this)&&!e.dead&&(e.vy>0&&e.y+e.h-e.vy<=this.y+12?(this.squished=!0,this.deadTimer=30,this.isShell=!0,e.vy=-6,i.updateScore(100),i.playSound("stomp")):e.invincible||this.isShell?this.isShell&&Math.abs(this.vx)>1&&e.takeDamage(i):(e.takeDamage(i),this.vx=i.gameConstants.ENEMY_KNOCKBACK,this.inShell=!0))}draw(t,e){if(!this.dead)if(this.squished)t.fillStyle="#228B22",t.beginPath(),t.ellipse(this.x+16,this.y+36,18,8,0,0,2*Math.PI,!1),t.fill(),t.fillStyle="#006400",t.beginPath(),t.ellipse(this.x+16,this.y+36,12,5,0,0,2*Math.PI,!1),t.fill(),t.fillStyle="#FFE4B5",t.beginPath(),t.ellipse(this.x+16,this.y+38,8,4,0,0,2*Math.PI,!1),t.fill(),t.fillStyle="#90EE90",t.beginPath(),t.arc(this.x+16,this.y+28,8,0,2*Math.PI,!1),t.fill(),t.fillStyle="#fff",t.beginPath(),t.arc(this.x+12,this.y+27,3,0,2*Math.PI,!1),t.arc(this.x+20,this.y+27,3,0,2*Math.PI,!1),t.fill(),t.fillStyle="#000",t.fillRect(this.x+11,this.y+27,2,2),t.fillRect(this.x+19,this.y+27,2,2);else if(this.isShell){const e=t.createRadialGradient(this.x+16,this.y+36,0,this.x+16,this.y+36,16);e.addColorStop(0,"#32CD32"),e.addColorStop(1,"#006400"),t.fillStyle=e,t.beginPath(),t.ellipse(this.x+16,this.y+36,16,11,0,0,2*Math.PI,!1),t.fill(),t.fillStyle="#228B22",t.beginPath(),t.ellipse(this.x+16,this.y+36,10,7,0,0,2*Math.PI,!1),t.fill(),t.strokeStyle="#004d00",t.lineWidth=2,t.beginPath(),t.ellipse(this.x+16,this.y+36,16,11,0,0,2*Math.PI,!1),t.stroke(),t.fillStyle="#FFE4B5",t.beginPath(),t.ellipse(this.x+16,this.y+38,10,5,0,0,2*Math.PI,!1),t.fill(),t.strokeStyle="rgba(0, 0, 0, 0.1)",t.lineWidth=1;for(let i=0;i<3;i++)t.beginPath(),t.moveTo(this.x+7,this.y+36+2*i),t.lineTo(this.x+25,this.y+36+2*i),t.stroke();t.fillStyle="rgba(255, 255, 255, 0.3)",t.beginPath(),t.ellipse(this.x+12,this.y+30,4,3,-.5,0,2*Math.PI,!1),t.fill()}else{const e=3*Math.sin(this.walkFrame);t.fillStyle="rgba(0, 0, 0, 0.2)",t.beginPath(),t.ellipse(this.x+16,this.y+42,14,5,0,0,2*Math.PI,!1),t.fill();const i=this.y+36+e;t.beginPath(),t.ellipse(this.x+8,this.y+42,6,3,0,0,2*Math.PI,!1),t.ellipse(this.x+24,this.y+42,6,3,0,0,2*Math.PI,!1),t.fill();const s=t.createRadialGradient(this.x+16,this.y+16,0,this.x+16,this.y+16,20);s.addColorStop(0,"#90EE90"),s.addColorStop(.6,"#32CD32"),s.addColorStop(1,"#228B22"),t.fillStyle=s,t.beginPath(),t.ellipse(this.x+16,this.y+16,15,20,0,0,2*Math.PI,!1),t.fill(),t.strokeStyle="rgba(0, 100, 0, 0.3)",t.lineWidth=1;for(let a=0;a<4;a++)t.beginPath(),t.arc(this.x+16,this.y+16,5+4*a,0,2*Math.PI,!1),t.stroke();const l=t.createRadialGradient(this.x+16,this.y+28,0,this.x+16,this.y+28,12);l.addColorStop(0,"#32CD32"),l.addColorStop(1,"#006400"),t.fillStyle=l,t.beginPath(),t.ellipse(this.x+16,this.y+28,12,8,0,0,2*Math.PI,!1),t.fill(),t.fillStyle="#228B22",t.beginPath(),t.ellipse(this.x+16,this.y+28,8,5,0,0,2*Math.PI,!1),t.fill(),t.strokeStyle="#004d00",t.lineWidth=2,t.beginPath(),t.ellipse(this.x+16,this.y+28,12,8,0,0,2*Math.PI,!1),t.stroke(),t.fillStyle="rgba(255, 255, 255, 0.25)",t.beginPath(),t.ellipse(this.x+12,this.y+24,5,3,-.3,0,2*Math.PI,!1),t.fill(),t.fillStyle="#90EE90",t.beginPath(),t.arc(this.x+16,this.y+6,10,0,2*Math.PI,!1),t.fill(),t.fillStyle="rgba(0, 100, 0, 0.1)",t.beginPath(),t.arc(this.x+16,this.y+8,7,0,2*Math.PI,!1),t.fill(),t.fillStyle="rgba(255, 255, 255, 0.35)",t.beginPath(),t.arc(this.x+13,this.y+3,4,0,2*Math.PI,!1),t.fill(),t.fillStyle="#fff",t.beginPath(),t.arc(this.x+11,this.y+5,5,0,2*Math.PI,!1),t.arc(this.x+21,this.y+5,5,0,2*Math.PI,!1),t.fill(),t.strokeStyle="#000",t.lineWidth=.5,t.beginPath(),t.arc(this.x+11,this.y+5,5,0,2*Math.PI,!1),t.arc(this.x+21,this.y+5,5,0,2*Math.PI,!1),t.stroke(),t.fillStyle="#000",t.beginPath(),t.arc(this.x+12,this.y+5,2.5,0,2*Math.PI,!1),t.arc(this.x+22,this.y+5,2.5,0,2*Math.PI,!1),t.fill(),t.fillStyle="#fff",t.fillRect(this.x+11,this.y+4,1.5,1.5),t.fillRect(this.x+21,this.y+4,1.5,1.5),t.fillStyle="rgba(255, 182, 193, 0.5)",t.beginPath(),t.ellipse(this.x+6,this.y+8,3,2,0,0,2*Math.PI,!1),t.ellipse(this.x+26,this.y+8,3,2,0,0,2*Math.PI,!1),t.fill(),t.fillStyle="#8B4513",t.beginPath(),t.ellipse(this.x+8,i,7,4,0,0,2*Math.PI,!1),t.ellipse(this.x+24,i,7,4,0,0,2*Math.PI,!1),t.fill(),t.fillStyle="#A0522D",t.beginPath(),t.ellipse(this.x+8,i-1,5,2,0,0,2*Math.PI,!1),t.ellipse(this.x+24,i-1,5,2,0,0,2*Math.PI,!1),t.fill()}}}class o extends s{constructor(t,e){super(t,e,28,28,"#e52521"),this.vx=2,this.vy=-2,this.spawning=!0,this.spawnY=e}update(t,e,i){if(this.spawning)return this.y-=1,void(this.y<=this.spawnY-32&&(this.spawning=!1));const s=i.gameConstants.GRAVITY||.4;this.vy+=s,this.x+=this.vx,this.y+=this.vy,t.forEach(t=>{t.broken||this.collide(t)&&(this.vy>0?(this.y=t.y-this.h,this.vy=0):this.vx>0?(this.vx=-2,this.x+=2*this.vx):(this.vx=2,this.x+=2*this.vx))}),this.y>i.canvas.height+50&&(this.dead=!0),e.collide(this)&&(e.grow(i),this.dead=!0)}draw(t,e){const i=t.createRadialGradient(this.x+14,this.y+10,0,this.x+14,this.y+10,14);i.addColorStop(0,"#FF4500"),i.addColorStop(.5,"#DC143C"),i.addColorStop(1,"#8B0000"),t.fillStyle=i,t.beginPath(),t.ellipse(this.x+14,this.y+10,14,12,0,Math.PI,2*Math.PI,!1),t.fill(),t.fillStyle="#FFE4C4",t.beginPath(),t.ellipse(this.x+14,this.y+10,10,5,0,0,2*Math.PI,!1),t.fill(),t.fillStyle="#fff",t.beginPath(),t.arc(this.x+8,this.y+6,4,0,2*Math.PI,!1),t.arc(this.x+20,this.y+6,4,0,2*Math.PI,!1),t.arc(this.x+14,this.y+3,3,0,2*Math.PI,!1),t.fill(),t.fillStyle="rgba(200, 200, 200, 0.5)",t.beginPath(),t.arc(this.x+9,this.y+7,2,0,2*Math.PI,!1),t.arc(this.x+21,this.y+7,2,0,2*Math.PI,!1),t.arc(this.x+15,this.y+4,1.5,0,2*Math.PI,!1),t.fill();const s=t.createLinearGradient(this.x+6,this.y+10,this.x+22,this.y+26);s.addColorStop(0,"#FFF8DC"),s.addColorStop(.5,"#FFE4C4"),s.addColorStop(1,"#DEB887"),t.fillStyle=s,t.fillRect(this.x+6,this.y+10,16,16),t.fillStyle="rgba(255, 255, 255, 0.4)",t.fillRect(this.x+8,this.y+12,4,12),t.fillStyle="#000",t.beginPath(),t.arc(this.x+10,this.y+18,3,0,2*Math.PI,!1),t.fill(),t.beginPath(),t.arc(this.x+18,this.y+18,3,0,2*Math.PI,!1),t.fill(),t.fillStyle="#fff",t.fillRect(this.x+10,this.y+17,1,1),t.fillRect(this.x+18,this.y+17,1,1),t.fillStyle="rgba(255, 182, 193, 0.6)",t.beginPath(),t.ellipse(this.x+7,this.y+22,3,2,0,0,2*Math.PI,!1),t.ellipse(this.x+21,this.y+22,3,2,0,0,2*Math.PI,!1),t.fill(),t.strokeStyle="#000",t.lineWidth=1,t.beginPath(),t.arc(this.x+14,this.y+22,4,.2,Math.PI-.2,!1),t.stroke()}}document.addEventListener("DOMContentLoaded",()=>{window.game=new t,window.game.init()});
